<div class="container">
  <div class = "row g-3">
    
    <div class="col-lg-2 col-md-3 col-sm-6 col-5 mx-auto">
      <%= profile_image(@user,@user.genre,180,180) %>
      
      <p class="mt-2 no-wrap">
        <%= @user.club_name %>
        <% if user_signed_in? %>
          <%= follow_button(@user,current_user) %>
        <% else %>
          <i class="fas fa-user-check"></i>
        <% end %>
        <%= @user.follows.count %>
      </p>
    </div>
    
    <div class="col-lg-9 col-md-8 col-sm-12 col-12">
      <div class="col-12">
        <h3 class="border-bottom border-secondary">
          <%= @recruit.title %>  
          <span class="h5">
            <%= like_button(current_user, @recruit) %>
            <%= @recruit.likes.count %>
          </span>
          
          <% if @recruit.open_status == false && @recruit.match? %>
            マッチ成立済
          <% elsif @recruit.open_status == false %>
            <span class="text-danger">
              ※公開停止中
            </span>
          <% end %>
        </h3>
      </div>
      
      <div class="col-12">
        <h5 class=" mt-4">
          <%= @recruit.date.strftime('%Y/%m/%d') %>に 
          @<%= @recruit.site.site_name %> で
          『<%= practice_type(@recruit) %>』 が
          できる相手を募集しています
        </h5>

        <% if @recruit.age_group_i18n != "指定なし" %>
          <p>※この募集対象は、<%= @recruit.age_group_i18n %>に限ります。</p>
        <% end %>
      </div>

      <div class="col-12 mt-4">
        <h5 class="mb-4">練習内容</h5>
        <div class="border p-3 border-secondary">
          <%= @recruit.detail %>
        </div>
      </div>

      <div class="col-12 mt-5 text-right">
      <% if @user == current_user %>
      <!--current_user が募集者の時-->
        <span>
          <% if @recruit.recruiting? || @recruit.having_candidates? %>
            <%= link_to '編集する', 
              edit_recruit_path(@recruit.id), 
              class:"btn btn-success mr-2 col-lg-3 col-md-4 col-sm-4 col-4 mt-1" 
            %>
          <% end %>
          <% if @recruit.having_candidates? && @recruit.entries.where(entry_status: 2).any? %>
            <%= link_to '応募受付終了', 
              recruit_path(@recruit, 
                recruit: {
                  recruit_status: "match", 
                  user_id: current_user.id, 
                  date: @recruit.date, 
                  title: @recruit.title, 
                  practice_type: @recruit.practice_type, 
                  detail: @recruit.detail, 
                  age_group: @recruit.age_group, 
                  open_status: false
                }, 
              site_id: @recruit.site_id ), 
              method: :patch, 
              class:"btn btn-info col-lg-3 col-md-4 col-sm-4 col-4 mt-1" 
            %>
          <% end %>
        </span>

      <% else %>
      <!--current_user が募集者でない時-->
        <% if (@entry.new_record? ) && (@recruit.recruiting? || @recruit.having_candidates?) %>
          <span>
            <%= link_to '応募する', 
              entries_path(@entry, 
                entry: {
                  recruit_id: @recruit.id, 
                  user_id: current_user.id
                }
              ), 
              method: :post, 
              class:"btn btn-primary col-lg-3 col-md-4 col-sm-4 col-4" 
            %>
          </span>
        <% end %>

        <% if @entry.id.present? && @recruit.having_candidates? %>
          <span>
            <%= link_to '応募取消', 
              entry_path(@entry.id), 
              method: :delete, 
              class:"btn btn-danger col-lg-3 col-md-4 col-sm-4 col-4" 
            %>
          </span>
        <% end %>

      <% end %>
      </div>
    </div>
  </div>
  
  
  <div class = "row g-3 mb-5">
    <% if @user == current_user %>
      <div class="col-12">
        <% if @recruit.having_candidates? && @entries.where(entry_status: 1).any? %>
          <h5>応募者一覧(募集状況: <%= @recruit.recruit_status_i18n %>)</h5>
        <% end %>
        
        <div class="col-12 d-flex flex-wrap" >
          <% @entries.each do |entry| %>
            <% if entry.recruit.having_candidates? && entry.entered? %>
              <div class="mr-5 mt-3 no-wrap">
                <p class="d-flex align-items-center mb-0 ml-2">
                  <%= profile_image(entry.user,entry.user.genre,40,40) %>
                </p>
                <p class="my-0 mr-0 ml-1 p-0">
                  <%= link_to entry_path(entry, 
                      entry: {
                        entry_status: "match", 
                        user_id: entry.user.id, 
                        recruit_id: entry.recruit.id 
                      }), 
                    method: :patch do 
                  %>
                    <i class="fas fa-check-circle mr-3"></i>
                  <% end %>
                  
                  <%= link_to entry_path(entry, 
                    entry: {
                      entry_status: "match_rejected", 
                      user_id: entry.user.id, 
                      recruit_id: entry.recruit.id 
                    }), method: :patch do 
                  %>
                    <i class="fas fa-times-circle reject-icon"></i>
                  <% end %>
                </p>
                <small>
                  <%= entry.user.club_name.truncate(8) %>
                </small>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  
  
  <div class="row g-3 mb-5">
    <div class="col-12">
      <% if @entries.where(entry_status: 2).any? %>  
        <h5>参加メンバー 
          <span>
            <% if @recruit.match? %>
              <%= room_link(@recruit.room, @recruit) %>
            <% end %>
          </span>
        </h5>
        
        <div class="col-12 d-flex flex-wrap" >
          <% @entries.each do |entry| %>
            <% if entry.match? %>
              <div class="mr-5 mt-3 ml-0">
                <p class="d-flex align-items-center mb-0 ml-2">
                  <%= profile_image(entry.user,entry.user.genre,40,40) %>
                </p>
                <small><%= entry.user.club_name.truncate(8) %></small>
              </div>
            <% end %>
          <% end %>
        </div>
  
      <% else %>
        <% if @entry.id.present? %>
          <p>応募状況: <%= @entry.entry_status_i18n %></p>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
